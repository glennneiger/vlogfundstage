!function(s){var n=s("#update-plugins-table,.wp-list-table.plugins"),i=function(e,t){this.data=e,this.parent=t,this.$check=n.find('.check-column [value="'+e.basename+'"]'),this.$row=this.$check.closest("tr"),this.$noticeContainer=null};i.prototype.checkAgainLink=function(){return' <a class="dbrains-check-my-licence-again" href="#">'+dbrains.strings.check_license_again+"</a>"},i.prototype.hasLicenseErrors=function(){var e=this.isAddon()?this.parent.data.license:this.data.license;return!_.isEmpty(e.errors)},i.prototype.disableUpdateCheckbox=function(){n.is("#update-plugins-table")&&this.$check.prop({disabled:!0,checked:!1})},i.prototype.enableUpdateCheckbox=function(){n.is("#update-plugins-table")&&this.$check.prop({disabled:!1})},i.prototype.setNotice=function(e){this.$noticeContainer.find(".wposes-license-notice").remove(),this.$noticeContainer.append('<div class="wposes-license-notice update-message notice inline notice-warning notice-alt"><p class="wposes-before">'+e+this.checkAgainLink()+"</p></div>")},i.prototype.clearNotice=function(){var e=this,t=this.$noticeContainer.find(".wposes-license-notice");s.when(t.fadeOut()).done(function(){t.remove(),e.$row.children().css("box-shadow",""),e.$noticeContainer.find(".update-message").show()})},i.prototype.render=function(){this.hasLicenseErrors()?(this.initNoticeContainer(),this.disableUpdateCheckbox(),this.$noticeContainer.find('.update-message:not(".wposes-license-notice")').hide(),this.setNotice(this.getLicenseNotice())):this.$noticeContainer&&(this.enableUpdateCheckbox(),this.clearNotice()),this.isAddon()||_.invoke(this.addons,"render")},i.prototype.initNoticeContainer=function(){if(!this.$noticeContainer){if(n.is("#update-plugins-table"))this.$noticeContainer=this.$row.find(".plugin-title");else{var e=n.find('.plugin-update-tr[data-plugin="'+this.data.basename+'"]');e.length?this.$noticeContainer=e.find(".plugin-update"):(this.$row.after('<tr class="plugin-update-tr '+this.$row.attr("class")+'" id="'+this.data.slug+'-update" data-slug="'+this.data.slug+'" data-plugin="'+this.data.basename+'" ><td colspan="3" class="plugin-update colspanchange"></td></tr>'),this.$row.children().css("box-shadow","none"),this.$noticeContainer=n.find('.plugin-update-tr[data-plugin="'+this.data.basename+'"] .plugin-update'))}this.$noticeContainer.on("click",".dbrains-check-my-licence-again",_.bind(this.checkLicenseAgain,this))}},i.prototype.getLicenseNotice=function(){return this.isAddon()?dbrains.strings.requires_parent_license.replace("%s",this.parent.data.name):_.values(this.data.license.errors).join("")},i.prototype.checkLicenseAgain=function(e){var t=this,n=s(e.target),i=s('<span class="spinner is-active dbrains-licence-check-spinner" style="float:none; margin-top: -3px;"></span>');e.preventDefault(),n.hide().after(i),this.ajaxCheckLicense().done(function(e){t.isAddon()?(t.parent.data.license.errors=e.errors,t.parent.render()):(t.data.license.errors=e.errors,t.render())}).fail(function(){t.setNotice(dbrains.strings.license_check_problem)}).always(function(){i.remove()})},i.prototype.ajaxCheckLicense=function(){var e=this.isAddon()?this.parent.data.prefix:this.data.prefix;return s.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:e+"_check_licence",nonce:dbrains.nonces.check_licence}})},i.prototype.init=function(){this.render(),this.isAddon()||this.initAddons()},i.prototype.isAddon=function(){return!!this.parent},i.prototype.initAddons=function(){var t=this;this.addons=_.map(this.data.addons,function(e){return new i(e,t)}),_.invoke(this.addons,"init")},n.length&&s(function(){_.chain(dbrains.plugins).map(function(e){return new i(e)}).invoke("init")})}(jQuery);