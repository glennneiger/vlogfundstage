!function(t,i){var n,e=ajaxurl.replace("/admin-ajax.php","")+"/images/spinner",c=t("body"),o=t(".wposes-main");function a(){return-1<window.location.href.indexOf("setup-wizard")}2<=window.devicePixelRatio&&(e+="-2x"),e+=".gif",wposes.spinnerUrl=e;var r=function(){this.$key=o.find(".wposes-licence-input"),this.$spinner=o.find("[data-wposes-licence-spinner]"),this.$feedback=o.find("[data-wposes-licence-feedback]")};function p(e){if("support"!==e&&t(".wposes-check-again").length){var s=t(".wposes-check-again").attr("href");wposes.tabs.defaultTab===e&&(e=""),""!==e&&(e="#"+e);var n=s.indexOf("#");0===n&&(n=s.length),s=s.substr(0,n)+e,t(".wposes-check-again").attr("href",s)}}r.prototype.activate=function(){var e=t.trim(this.$key.val());return""===e?(this.$feedback.addClass("notice-error"),void this.$feedback.html("<p>"+wposes.strings.enter_licence_key+"</p>").show()):this.sendRequest("activate",{licence_key:e}).done(function(e){e.success&&e.data&&(this.$key.val(e.data.masked_licence),this.$key.prop("disabled","disabled"))}.bind(this)).fail(function(){this.$feedback.html("<p>"+wposes.strings.register_licence_problem+"</p>").show()}.bind(this))},r.prototype.remove=function(){return this.sendRequest("remove").done(function(e){e.success&&this.$key.val("")}.bind(this))},r.prototype.check=function(){return this.sendRequest("check").fail(function(e){e.readyState<4||alert(wposes.strings.licence_check_problem)})},r.prototype.sendRequest=function(e,s){var n={action:"wposes_"+e+"_licence",_ajax_nonce:wposes.nonces[e+"_licence"]};return i.isObject(s)&&(n=i.extend(n,s)),a()||this.$spinner.addClass("is-active").show(),t.post(ajaxurl,n).done(function(e){this.$feedback.toggleClass("notice-success",e.success).toggleClass("notice-error",!e.success),e.data&&e.data.message&&this.$feedback.html("<p>"+e.data.message+"</p>").show(),e.success&&(a()?window.location.hash="create-iam-user":wposes.reloadUpdated())}.bind(this)).always(function(){this.$spinner.removeClass("is-active").hide()}.bind(this))},n=i.once(function(e){var s=o.find(".support-content"),n=new r;t(".wposes-licence-notice").remove(),n.check({licence:e}).done(function(e){i.isEmpty(e.dbrains_api_down)?i.isArray(e.htmlErrors)&&e.htmlErrors.length?s.html(e.htmlErrors.join("")):s.html(e.message):s.html(e.dbrains_api_down+e.message),i.isEmpty(e.pro_error)||0!==t(".wposes-license-notice").length||t(".wposes-main #wposes-settings-sub-nav").after(e.pro_error)})}),t(document).on("wposes.tabRendered",function(e,s){"support"===s&&"1"===wposes.strings.has_licence?n():"licence"===s?(t("#wposes_license_notice_no_licence").hide(),t(".wposes-licence-input").focus()):"reports"===s?t("#wposes_license_notice_no_licence").hide():t("#wposes_license_notice_no_licence").show(),p(s)}),o.on("click","[data-wposes-licence-action]",function(e){var s=t(this).data("wposesLicenceAction"),n=new r;e.preventDefault(),"function"==typeof n[s]&&n[s]()}),t(document).ready(function(){var e;p((e="",window.location.hash&&(e=window.location.hash.substring(1)),e=wposes.tabs.sanitizeHash(e)));var s,n,i=t("#tab-"+wposes.tabs.defaultTab+" .wposes-main-settings form");s=t(i).serializeArray(),n={},t.each(s,function(e,s){n[s.name]=s.value}),n,c.on("click",".reactivate-licence",function(e){e.preventDefault();var i=t("<div/>",{id:"processing-licence"}).html(wposes.strings.attempting_to_activate_licence);i.append('<img src="'+wposes.spinnerUrl+'" alt="" class="check-licence-ajax-spinner general-spinner" />'),t(".wposes-invalid-licence").hide().after(i),t.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wposes_reactivate_licence",nonce:wposes.nonces.reactivate_licence},error:function(e,s,n){i.remove(),t(".wposes-invalid-licence").show().html(wposes.strings.activate_licence_problem),t(".wposes-invalid-licence").append("<br /><br />"+wposes.strings.status+": "+e.status+" "+e.statusText+"<br /><br />"+wposes.strings.response+"<br />"+e.responseText)},success:function(e){if(i.remove(),void 0===e.wposes_error||1!==e.wposes_error){if(void 0!==e.dbrains_api_down&&1===e.dbrains_api_down)return t(".wposes-invalid-licence").html(wposes.strings.temporarily_activated_licence),void t(".wposes-invalid-licence").append(e.body).show();t(".wposes-invalid-licence").empty().html(wposes.strings.licence_reactivated),t(".wposes-invalid-licence").addClass("success notification-message success-notice").show(),location.reload()}else t(".wposes-invalid-licence").html(e.body).show()}})}),c.on("click",".support-tab-link",function(e){wposes.tabs.toggle("support")}),t("#tab-start .wposes-wizard-next-btn").click(function(e){(e.preventDefault(),t(".wposes-licence-input").prop("disabled"))?window.location.hash="create-iam-user":(new r).activate()})})}(jQuery,_);